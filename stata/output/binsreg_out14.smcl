{com}. tempfile file_q25 file_q75 file_reg
{txt}
{com}. preserve
{txt}
{com}. binsqreg y x, quantile(0.25) line(3 3) savedata(`file_q25')
{txt}Sorting dataset on x...
Note: This step is omitted if dataset already sorted by x.
{res}
{txt}Binscatter plot, quantile
Bin selection method: IMSE-optimal plug-in choice
Placement: Quantile-spaced
Derivative: 0
Output file: /var/folders/85/ghqhbjfx4ysg9_s5gs0byqlw0000gn/T//S_02658.000003.dta

{hline 30}{c TT}{hline 15}
{lalign 1:# of observations}{col 30} {c |} {col 32}{res}   1000
{txt}{lalign 1:# of distinct values}{col 30} {c |} {col 32}{res}   1000
{txt}{lalign 1:# of clusters}{col 30} {c |} {col 32}{res}      .
{txt}{hline 30}{c +}{hline 15}
{lalign 1:Bin selection:}{col 30} {c |} 
{ralign 29:Degree of polynomial}{col 30} {c |} {col 32}{res}      0
{txt}{ralign 29:# of smoothness constraints}{col 30} {c |} {col 32}{res}      0
{txt}{ralign 29:# of bins}{col 30} {c |} {col 32}{res}     20
{txt}{hline 30}{c BT}{hline 15}

{hline 9}{c TT}{hline 30}
{col 10}{c |}{col 17}p{col 25}s{col 33}df
{hline 9}{c +}{hline 30}
{lalign 1: dots}{col 10}{c |}{col 17}0{col 25}0{col 33}20
{lalign 1: line}{col 10}{c |}{col 17}3{col 25}3{col 33}23
{hline 9}{c BT}{hline 30}
{res}{txt}
{com}. binsqreg y x, quantile(0.75) line(3 3) savedata(`file_q75')
{txt}Sorting dataset on x...
Note: This step is omitted if dataset already sorted by x.
{res}
{txt}Binscatter plot, quantile
Bin selection method: IMSE-optimal plug-in choice
Placement: Quantile-spaced
Derivative: 0
Output file: /var/folders/85/ghqhbjfx4ysg9_s5gs0byqlw0000gn/T//S_02658.000004.dta

{hline 30}{c TT}{hline 15}
{lalign 1:# of observations}{col 30} {c |} {col 32}{res}   1000
{txt}{lalign 1:# of distinct values}{col 30} {c |} {col 32}{res}   1000
{txt}{lalign 1:# of clusters}{col 30} {c |} {col 32}{res}      .
{txt}{hline 30}{c +}{hline 15}
{lalign 1:Bin selection:}{col 30} {c |} 
{ralign 29:Degree of polynomial}{col 30} {c |} {col 32}{res}      0
{txt}{ralign 29:# of smoothness constraints}{col 30} {c |} {col 32}{res}      0
{txt}{ralign 29:# of bins}{col 30} {c |} {col 32}{res}     20
{txt}{hline 30}{c BT}{hline 15}

{hline 9}{c TT}{hline 30}
{col 10}{c |}{col 17}p{col 25}s{col 33}df
{hline 9}{c +}{hline 30}
{lalign 1: dots}{col 10}{c |}{col 17}0{col 25}0{col 33}20
{lalign 1: line}{col 10}{c |}{col 17}3{col 25}3{col 33}23
{hline 9}{c BT}{hline 30}
{res}{txt}
{com}. binsreg y x, line(3 3) cb(3 3) savedata(`file_reg')
{txt}Sorting dataset on x...
Note: This step is omitted if dataset already sorted by x.
{res}
{txt}Binscatter plot
Bin selection method: IMSE-optimal plug-in choice
Placement: Quantile-spaced
Derivative: 0
Output file: /var/folders/85/ghqhbjfx4ysg9_s5gs0byqlw0000gn/T//S_02658.000005.dta

{hline 30}{c TT}{hline 15}
{lalign 1:# of observations}{col 30} {c |} {col 32}{res}   1000
{txt}{lalign 1:# of distinct values}{col 30} {c |} {col 32}{res}   1000
{txt}{lalign 1:# of clusters}{col 30} {c |} {col 32}{res}      .
{txt}{hline 30}{c +}{hline 15}
{lalign 1:Bin selection:}{col 30} {c |} 
{ralign 29:Degree of polynomial}{col 30} {c |} {col 32}{res}      0
{txt}{ralign 29:# of smoothness constraints}{col 30} {c |} {col 32}{res}      0
{txt}{ralign 29:# of bins}{col 30} {c |} {col 32}{res}     20
{txt}{hline 30}{c BT}{hline 15}

{hline 9}{c TT}{hline 30}
{col 10}{c |}{col 17}p{col 25}s{col 33}df
{hline 9}{c +}{hline 30}
{lalign 1: dots}{col 10}{c |}{col 17}0{col 25}0{col 33}20
{lalign 1: line}{col 10}{c |}{col 17}3{col 25}3{col 33}23
{lalign 1: CB}{col 10}{c |}{col 17}3{col 25}3{col 33}23
{hline 9}{c BT}{hline 30}
{res}{txt}
{com}. use `file_reg', clear
{txt}
{com}. append using `file_q25' `file_q75', generate(source)
{txt}
{com}. twoway (scatter dots_fit dots_x if source==0, mcolor(navy)) ///
>        (line line_fit line_x if source==0, sort lcolor(navy)) ///
>            (rarea CB_l CB_r CB_x if source==0, sort fcolor(navy%50) lcolor(none%0) fintensity(50)) ///
>            (line line_fit line_x if source==1, sort) ///
>            (line line_fit line_x if source==2, sort), ///
>            ytitle(Y) xtitle(X) title(Binscatter Plot) ///
>            legend(order(1 "E[Y|X]" 2 "E[Y|X]" 3 "Conf. Band for E[Y|X]" 4 "0.25 quantile" 5 "0.75 quantile"))
{res}{txt}
{com}. restore
{txt}
