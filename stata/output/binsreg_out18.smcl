{com}. qui binsregselect y x w, simsgrid(30) savegrid(output/parfitval) replace
{txt}
{com}. qui reg y x w
{txt}
{com}. use output/parfitval, clear
{txt}
{com}. predict binsreg_fit_lm
{txt}(option {bf:xb} assumed; fitted values)

{com}. save output/parfitval, replace
{txt}file output/parfitval.dta saved

{com}. use binsreg_simdata, clear
{txt}
{com}. binstest y x w, testmodelparfit(output/parfitval) lp(2)
{res}
{txt}Hypothesis tests based on binscatter estimates
Estimation method: reg
Bin selection method: IMSE-optimal plug-in choice
Placement: Quantile-spaced
Derivative: 0

{hline 30}{c TT}{hline 15}
{lalign 1:# of observations}{col 30} {c |} {col 32}{res}   1000
{txt}{lalign 1:# of distinct values}{col 30} {c |} {col 32}{res}   1000
{txt}{lalign 1:# of clusters}{col 30} {c |} {col 32}{res}      .
{txt}{hline 30}{c +}{hline 15}
{lalign 1:Bin selection:}{col 30} {c |} 
{ralign 29:Degree of polynomial}{col 30} {c |} {col 32}{res}      2
{txt}{ralign 29:# of smoothness constraints}{col 30} {c |} {col 32}{res}      2
{txt}{ralign 29:# of bins}{col 30} {c |} {col 32}{res}      4
{txt}{hline 30}{c BT}{hline 15}

Model specification Tests:
Degree: 3{col 15}# of smoothness constraints: 3

Input file: output/parfitval.dta
{hline 19}{c TT}{hline 30}
H0: mu ={col 20}{c |}{col 22}L2 of T{col 40}p value
{hline 19}{c +}{hline 30}
{res}{rcenter 19:binsreg_fit_lm}{col 20}{txt}{c |}{col 22}{res}  2.337{col 40}  0.000
{txt}{hline 19}{c BT}{hline 30}
